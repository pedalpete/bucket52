{"version":3,"sources":["meteor://ðŸ’»app/bucket52.js"],"names":[],"mappings":";;;;;;;;AAAA,QAAQ,GAAG,IAAI,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;;AAE5C,IAAI,GAAG,GAAG;AACT,cAAa,EAAE,YAAW;AACzB,MAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,MAAM,CAAC,MAAM,EAAE,EAAC,CAAC,CAAC;AACtD,MAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAS,GAAG,EAAC;AACnC,OAAI,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,GAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;AAC9C,OAAG,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,GAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,EAAE,CAAC;IACpC;AACD,MAAG,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,GAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;GACzC,CAAC,CAAC;AACJ,SAAO,GAAG,CAAC,KAAK,CAAC;EACjB;AACD,eAAc,EAAE,UAAS,IAAI,EAAE;AAC9B,SAAO,IAAI,KAAK,IAAI,CAAC,WAAW,CAAC;EACjC;AACD,SAAQ,EAAE,UAAS,SAAS,EAAE,IAAI,EAAE;AACnC,SAAO,IAAI,MAAM,CAAC,GAAG,GAAG,SAAS,GAAG,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC;EAC1E;AACD,QAAO,EAAE,YAAW;AACnB,MAAI,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AACtB,MAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;;AAE1B,MAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;;AAE3D,MAAI,KAAK,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;;AAE/C,SAAO,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,GAAG,KAAK,CAAC,OAAO,EAAE,IAAI,QAAQ,GAC5D,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;EAC3C;AACD,KAAI,EAAE,YAAW;AAChB,MAAI,CAAC,WAAW,GAAG,IAAI,CAAC,OAAO,EAAE,GAAE,CAAC,CAAC;AACrC,SAAO,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AAC9B,MAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,UAAC,CAAC,EAAC,CAAC,EAAK;AAC/D,UAAO;AACN,UAAM,EAAE,CAAC,GAAC,CAAC;AACX,cAAU,EAAE,EAAE;IACd,CAAC;GACF,CAAC,CAAC;AACH,MAAI,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC;EAEhD;AACD,SAAQ,EAAE,EAAE;AACZ,SAAQ,EAAE;AACT,OAAK,EAAE,QAAQ;EACf;CACD,CAAC;;AAGF,IAAI,MAAM,CAAC,QAAQ,EAAE;AACpB,SAAQ,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY;AACtC,MAAI,QAAQ,GAAG,IAAI,CAAC;AACpB,KAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,IAAI,QAAQ,CAAC;AACjC,SAAM,EAAE,QAAQ,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AAC3C,UAAO,EAAE,CAAC,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;AAC7B,YAAS,EAAE,GAAG;AACd,cAAW,EAAE,EAAE;GACf,CAAC,CAAC;EACH,CAAC,CAAC;;AAEH,QAAO,CAAC,OAAO,CAAC,YAAW;AAC1B,MAAI,CAAC,MAAM,CAAC,MAAM,EAAE,EAAE;;AAErB,MAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,QAAQ,CAAC;AAC9B,OAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,EAAE,OAAO;AAC/B,MAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;GAC3B;EACD,CAAC,CAAC;;AAEH,IAAG,CAAC,IAAI,EAAE,CAAC;AACX,OAAM,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;AAC7B,SAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC;AACzB,OAAK,EAAE,YAAW;AACjB,UAAO,GAAG,CAAC,aAAa,EAAE,CAAC;GAC3B;EACD,CAAC,CAAC;;AAEH,SAAQ,CAAC,SAAS,CAAC,MAAM,CAAC;AACzB,sBAAoB,EAAE,UAAS,GAAG,EAAE;AACnC,OAAI,OAAO,GAAG;AACb,QAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK;AAC9B,QAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK;IAC9B,CAAC;AACF,MAAG,CAAC,cAAc,EAAE,CAAC;AACrB,OAAG,CAAC,GAAG,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,OAAO,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC;AAChE,SAAM,CAAC,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;AAClC,UAAO,CAAC,IAAI,EAAE,CAAC;GACf;AACD,kBAAgB,EAAE,UAAS,GAAG,EAAE;AAC/B,OAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC;AAC1D,OAAI,SAAS,GAAG,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAC7C,OAAI,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE;AAC9C,WAAO,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC;IACjC;AACD,OAAI,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,IAAI,SAAS,EAAE,OAAO,MAAM,CAAC,SAAS,GAAC,EAAE,CAAC;GAC3E;EACD,CAAC,CAAC;AACH,SAAQ,CAAC,MAAM,CAAC,MAAM,CAAC;AACtB,sBAAoB,EAAE,UAAS,GAAG,EAAE;AACnC,OAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,KAAK,QAAQ,EAAC;AAClC,OAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,MAAM,CAAC;AAC3B,WAAO,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;IAClC;AACD,MAAG,CAAC,QAAQ,CAAC,KAAK,GAAG,QAAQ,CAAC;AAC9B,MAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;GAC3B;EACD,CAAC,CAAC;;AAEH,SAAQ,CAAC,MAAM,CAAC,MAAM,CAAC;AACtB,iBAAe,EAAE,UAAS,GAAG,EAAE;AAC9B,OAAI,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;AAC7D,OAAI,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC,KAAK,CAAC;AACjE,SAAM,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC,CAAC;AAChC,MAAG,CAAC,KAAK,CAAC,IAAI,GAAC,CAAC,CAAC,CAAC,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,IAAI,GAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,UAAS,GAAG,EAAC;AAC3E,WAAO,GAAG,CAAC,EAAE,KAAK,EAAE,CAAC;IACrB,CAAC,CAAC;AACH,UAAO,CAAC,IAAI,EAAE,CAAC;GACf;EACD,CAAC;CACF;;AAED,MAAM,CAAC,OAAO,CAAC;AACd,UAAS,EAAE,UAAS,OAAO,EAAE;AAC5B,MAAI,CAAE,MAAM,CAAC,MAAM,EAAE,EAAE;AACjB,SAAM,IAAI,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;GAC3C;AACJ,MAAI,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,OAAO,CAAC,IAAI,GAAG,EAAE,EAAC;AACzC,SAAM,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;GACvC;AACD,UAAQ,CAAC,MAAM,CAAC;AACf,OAAI,EAAE,OAAO,CAAC,IAAI;AAClB,YAAS,EAAE,IAAI,IAAI,EAAE;AACrB,OAAI,EAAE,OAAO,CAAC,IAAI;AAClB,QAAK,EAAE,MAAM,CAAC,MAAM,EAAE;GACtB,CAAC,CAAC;EACH;AACD,aAAY,EAAE,UAAS,EAAE,EAAE;AAC1B,MAAI,GAAG,GAAG,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;AAC/B,MAAG,GAAG,CAAC,KAAK,KAAK,MAAM,CAAC,MAAM,EAAE,EAAC;AAChC,SAAM,IAAI,MAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;GACzC;AACD,UAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;EACpB;CACD,CAAC,CAAC;;AAEH,IAAI,MAAM,CAAC,QAAQ,EAAE;AACnB,OAAM,CAAC,OAAO,CAAC,YAAY;AAC5B,QAAM,CAAC,OAAO,CAAC,UAAU,EAAE,YAAY;AACtC,UAAO,QAAQ,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,IAAI,CAAC,MAAM,EAAC,CAAC,CAAC;GAC3C,CAAC,CAAC;EACD,CAAC,CAAC;CACJ,wE","file":"/bucket52.js","sourcesContent":["Memories = new Mongo.Collection(\"memories\");\r\n\r\nvar b52 = {\r\n\tbuildMemories: function() {\r\n\t\tthis.memories = Memories.find({owner: Meteor.userId()});\r\n\t\t\t\tthis.memories.forEach(function(mem){\r\n\t\t\t\tif (b52.weeks[mem.week-1].memories.length > 0) {\r\n\t\t\t\t\tb52.weeks[mem.week-1].memories = [];\r\n\t\t\t\t}\r\n\t\t\t\tb52.weeks[mem.week-1].memories.push(mem);\r\n\t\t\t});\r\n\t\treturn b52.weeks;\r\n\t},\r\n\tcheckValidWeek: function(week) {\r\n\t\treturn week === this.currentWeek;\r\n\t},\r\n\thasClass: function(className, elem) {\r\n\t\treturn new RegExp(' ' + className + ' ').test(' ' + elem.className + ' ');\r\n\t},\r\n\tgetWeek: function() {\r\n\t\tvar date = new Date();\r\n\t\tdate.setHours(0, 0, 0, 0);\r\n\t\t// Thursday in current week decides the year.\r\n\t\tdate.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);\r\n\t\t// January 4 is always in week 1.\r\n\t\tvar week1 = new Date(date.getFullYear(), 0, 4);\r\n\t\t// Adjust to Thursday in week 1 and count number of weeks from date to week1.\r\n\t\treturn 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000\r\n\t\t\t\t\t\t\t\t- 3 + (week1.getDay() + 6) % 7) / 7);\r\n\t},\r\n\tinit: function() {\r\n\t\tthis.currentWeek = this.getWeek() -1;\r\n\t\tconsole.log(this.currentWeek);\r\n\t\tthis.weeks = Math.pow(2, 52).toString(2).split('').map((i,j) => {\r\n\t\t\treturn {\r\n\t\t\t\t'week': j+1,\r\n\t\t\t\t'memories': []\r\n\t\t\t};\r\n\t\t});\r\n\t\tthis.weeks[this.currentWeek].currentWeek = true;\r\n\t\t\r\n\t},\r\n\tmemories: [],\r\n\tslideout: {\r\n\t\tstate: 'closed'\r\n\t}\r\n}; \r\n\r\n\r\nif (Meteor.isClient) {\r\n\tTemplate.layout.onRendered(function () {\r\n\t\tvar template = this;\r\n\t\tb52.slideout.model = new Slideout({\r\n\t\t\t'menu': template.$('.slideout-menu').get(0),\r\n\t\t\t'panel': $('.content').get(0),\r\n\t\t\t'padding': 256,\r\n\t\t\t'tolerance': 70\r\n\t\t});\r\n\t});\r\n\t\r\n\tTracker.autorun(function() {\r\n\t\tif (!Meteor.userId()) {\r\n\t\t\t//make sure the menu is closed\r\n\t\t\tb52.slideout.state = 'closed';\r\n\t\t\tif(!b52.slideout.model) return;\r\n\t\t\tb52.slideout.model.close();\r\n\t\t}\r\n\t});\r\n\t\r\n\tb52.init();\r\n\tMeteor.subscribe(\"memories\");\r\n\tTemplate.calendar.helpers({\r\n\t\tweeks: function() {\r\n\t\t\treturn b52.buildMemories();\r\n\t\t}\r\n\t});\r\n\t\r\n\tTemplate.addMemory.events({\r\n\t\t\"submit .add-memory\": function(evt) {\r\n\t\t\tvar formObj = {\r\n\t\t\t\ttext: evt.target.text[0].value,\r\n\t\t\t\tweek: evt.target.text[1].value\r\n\t\t\t};\r\n\t\t\tevt.preventDefault();\r\n\t\t\tif(!b52.checkValidWeek(formObj.week)) return Router.go('error');\r\n\t\t\tMeteor.call('addMemory', formObj);\r\n\t\t\thistory.back();\r\n\t\t},\r\n\t\t\"keyup textarea\": function(evt) {\r\n\t\t\tvar button = document.querySelector('.add-memory button');\r\n\t\t\tvar isVisible = b52.hasClass('show', button);\r\n\t\t\tif (evt.target.value.length > 0 && !isVisible) {\r\n\t\t\t\treturn button.className = 'show';\r\n\t\t\t}\r\n\t\t\tif (evt.target.value.length === 0 && isVisible) return button.className='';\r\n\t\t}\r\n\t});\r\n\tTemplate.header.events({\r\n\t\t'click .menu-button': function(evt) {\r\n\t\t\tif(b52.slideout.state === 'closed'){\r\n\t\t\t\tb52.slideout.state = 'open';\t\r\n\t\t\t \treturn b52.slideout.model.open();\r\n\t\t\t}\r\n\t\t\tb52.slideout.state = 'closed';\r\n\t\t\tb52.slideout.model.close();\r\n\t\t}\r\n\t});\r\n\t\r\n\tTemplate.memory.events({\r\n\t\t'click .delete': function(evt) {\r\n\t\t\tvar id = evt.target.attributes.getNamedItem('data-id').value;\r\n\t\t\tvar week = evt.target.attributes.getNamedItem('data-week').value;\r\n\t\t\tMeteor.call('deleteMemory', id);\r\n\t\t\tb52.weeks[week-1].memories = b52.weeks[week-1].memories.filter(function(mem){\r\n\t\t\t\treturn mem.id === id;\r\n\t\t\t});\r\n\t\t\thistory.back();\r\n\t\t}\r\n\t})\r\n}\r\n\r\nMeteor.methods({\r\n\taddMemory: function(formObj) {\r\n\t\tif (! Meteor.userId()) {\r\n      \t\tthrow new Meteor.Error(\"not-authorized\");\r\n    \t}\r\n\t\tif (formObj.week < 1 || formObj.week > 53){\r\n\t\t\tthrow new Meteor.Error(\"invalid-week\");\r\n\t\t}\r\n\t\tMemories.insert({\r\n\t\t\ttext: formObj.text,\r\n\t\t\tcreatedAt: new Date(),\r\n\t\t\tweek: formObj.week,\r\n\t\t\towner: Meteor.userId()\r\n\t\t});\r\n\t},\r\n\tdeleteMemory: function(id) {\r\n\t\tvar mem = Memories.findOne(id);\r\n\t\tif(mem.owner !== Meteor.userId()){\r\n\t\t\tthrow new Meteor.Error('not authorized');\r\n\t\t}\r\n\t\tMemories.remove(id);\r\n\t}\r\n});\r\n\r\nif (Meteor.isServer) {\r\n  Meteor.startup(function () {\r\n\tMeteor.publish(\"memories\", function () {\r\n\t\treturn Memories.find({owner: this.userId});\r\n\t});\r\n  });\r\n}"]}